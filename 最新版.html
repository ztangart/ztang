<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>高德地图 - 圆点标记 + 浅蓝导航栏 + 搜索框</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; font-family: Arial, sans-serif; overflow: hidden; }
    #container {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    /* ✅ 导航栏：浅蓝色背景 */
    #navbar {
      height: 50px;
      background: #e3f2fd; /* 浅蓝色 */
      color: #0d47a1; /* 深蓝文字 */
      display: flex;
      align-items: center;
      padding: 0 15px;
      z-index: 100;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .nav-item {
      padding: 10px 15px;
      cursor: pointer;
      border-radius: 4px;
      margin-right: 10px;
      transition: background 0.2s;
      color: #0d47a1;
      font-weight: bold;
    }
    .nav-item:hover {
      background: #bbdefb;
    }
    .nav-item.active {
      background: #90caf9;
    }

    /* ✅ 搜索框容器 */
    #search-container {
      flex: 1;
      display: flex;
      justify-content: center;
      padding: 0 20px;
    }
    #search-input {
      width: 300px;
      max-width: 60%;
      padding: 8px 12px;
      border: 1px solid #90caf9;
      border-radius: 20px;
      font-size: 14px;
      outline: none;
      background: white;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
    #search-input:focus {
      border-color: #1a73e8;
    }

    #map-container {
      flex: 1;
      position: relative;
    }
    #map {
      width: 100%;
      height: 100%;
      background: #eee;
    }

    /* 侧边栏等样式保持不变（略） */
    #sidebar {
      position: absolute;
      top: 50px;
      left: 0;
      width: 320px;
      height: calc(100% - 50px);
      background: #f8f9fa;
      border-right: 1px solid #ddd;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      z-index: 99;
      transition: transform 0.3s ease;
    }
    #sidebar.hidden {
      transform: translateX(-100%);
    }
    #sidebar-header {
      padding: 12px;
      background: #fff;
      border-bottom: 1px solid #eee;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #folder-list {
      flex: 1;
      overflow-y: auto;
      padding: 8px;
    }
    .folder-item {
      margin: 6px 0;
      padding: 8px;
      background: #fff;
      border-radius: 4px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      border: 1px solid #e9ecef;
    }
    .folder-title {
      font-weight: bold;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 4px 0;
    }
    .folder-actions {
      display: flex;
      gap: 4px;
    }
    .marker-list {
      margin-top: 8px;
      display: none;
    }
    .marker-list.show {
      display: block;
    }
    .marker-item {
      padding: 8px 8px 8px 28px;
      font-size: 14px;
      color: #333;
      cursor: pointer;
      border-left: 3px solid transparent;
      border-radius: 3px;
      margin: 4px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .marker-item:hover {
      background: #e9ecef;
    }
    .marker-item.active {
      border-left-color: #1a73e8;
      background: #e8f0fe;
    }
    .btn {
      padding: 6px 12px;
      font-size: 13px;
      cursor: pointer;
      border: none;
      border-radius: 4px;
      background: #0d6efd;
      color: white;
      transition: background 0.2s;
    }
    .btn:hover {
      background: #0b5ed7;
    }
    .btn-sm {
      padding: 4px 8px;
      font-size: 12px;
    }
    .btn-danger {
      background: #dc3545;
    }
    .btn-danger:hover {
      background: #bb2d3b;
    }
    .btn-warning {
      background: #ffc107;
      color: #000;
    }
    .btn-warning:hover {
      background: #ffca2c;
    }
    .btn-success {
      background: #198754;
    }
    .btn-success:hover {
      background: #157347;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 8px;
      width: 400px;
      max-width: 90vw;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .modal h4 {
      margin: 0 0 15px 0;
      color: #333;
    }
    .form-group {
      margin-bottom: 12px;
    }
    .form-group label {
      display: block;
      margin-bottom: 4px;
      font-weight: bold;
      color: #555;
    }
    .form-group input, .form-group select, .form-group textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    .form-row {
      display: flex;
      gap: 10px;
    }
    .form-row > div {
      flex: 1;
    }
    .info-content {
      max-width: 280px;
      line-height: 1.5;
    }
    .info-content h4 {
      margin: 0 0 8px 0;
      color: #1a73e8;
      font-size: 16px;
    }
    .info-content p {
      margin: 5px 0;
      font-size: 14px;
    }
    .marker-date {
      font-size: 12px;
      color: #666;
      font-style: italic;
    }
    .marker-count {
      font-size: 12px;
      color: #666;
    }
    .folder-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .marker-actions {
      display: flex;
      gap: 4px;
    }
    .marker-title {
      flex: 1;
    }
    .stats-bar {
      padding: 8px 12px;
      background: #e9ecef;
      font-size: 12px;
      color: #666;
      border-bottom: 1px solid #ddd;
    }
    .toggle-section {
      padding: 8px 12px;
      background: #e9ecef;
      border-top: 1px solid #ddd;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .toggle-section button {
      padding: 4px 8px;
      font-size: 12px;
    }
  </style>
  <!-- ✅ 加载高德 UI 组件（用于 Autocomplete） -->
  <script src="https://webapi.amap.com/maps?v=2.0&key=da1c084878bdd9a0003e9db6d7f7de88&plugin=AMap.Autocomplete,AMap.PlaceSearch"></script>
</head>
<body>
  <div id="container">
    <div id="navbar">
      <div class="nav-item active" id="navMarkers" onclick="toggleSidebar()">标记管理</div>
      <div class="nav-item" onclick="alert('地图工具')">地图工具</div>
      <div class="nav-item" onclick="alert('设置功能')">设置</div>
      <div class="nav-item" onclick="alert('帮助功能')">帮助</div>

      <!-- ✅ 搜索框居中 -->
      <div id="search-container">
        <input type="text" id="search-input" placeholder="搜索地点（如：北京故宫）" />
      </div>
    </div>

    <div id="map-container">
      <div id="sidebar" class="hidden">
        <div class="stats-bar">
          共 <span id="total-markers">0</span> 个标记，<span id="total-folders">0</span> 个分组
        </div>
        <div id="sidebar-header">
          <span>标记管理</span>
          <div>
            <button class="btn btn-sm" onclick="createNewFolder()">新建分组</button>
            <button class="btn btn-sm" style="margin-left: 5px;" onclick="showImportModal()">导入</button>
          </div>
        </div>
        <div id="folder-list"></div>
      </div>
      <div id="map"></div>
    </div>
  </div>

  <!-- 弹窗部分保持不变（略） -->
  <div id="addMarkerModal" class="modal">
    <div class="modal-content">
      <h4 id="modalTitle">添加标记</h4>
      <div class="form-group">
        <label for="inputTitle">标题 *</label>
        <input type="text" id="inputTitle" placeholder="请输入标记标题" />
      </div>
      <div class="form-group">
        <label for="inputDescription">描述</label>
        <textarea id="inputDescription" placeholder="请输入标记描述" rows="3"></textarea>
      </div>
      <div class="form-row">
        <div class="form-group">
          <label for="inputStart">开始日期 *</label>
          <input type="date" id="inputStart" />
        </div>
        <div class="form-group">
          <label for="inputEnd">结束日期 *</label>
          <input type="date" id="inputEnd" />
        </div>
      </div>
      <div class="form-group">
        <label for="folderSelect">所属分组 *</label>
        <select id="folderSelect"></select>
      </div>
      <div style="margin-top: 15px; text-align: right;">
        <button class="btn btn-danger" onclick="closeAddMarkerModal()">取消</button>
        <button class="btn" onclick="confirmAddMarker()" id="confirmBtn">确定</button>
      </div>
    </div>
  </div>

  <div id="editFolderModal" class="modal">
    <div class="modal-content">
      <h4 id="editFolderModalTitle">编辑分组</h4>
      <div class="form-group">
        <label for="editFolderName">分组名称</label>
        <input type="text" id="editFolderName" placeholder="请输入分组名称" />
      </div>
      <div style="margin-top: 15px; text-align: right;">
        <button class="btn btn-danger" onclick="closeEditFolderModal()">取消</button>
        <button class="btn" onclick="confirmEditFolder()">确定</button>
      </div>
    </div>
  </div>

  <div id="importModal" class="modal">
    <div class="modal-content">
      <h4>导入标记数据</h4>
      <div class="form-group">
        <label>请粘贴JSON格式的标记数据：</label>
        <textarea id="importData" placeholder="粘贴标记数据JSON" rows="6"></textarea>
      </div>
      <div style="margin-top: 15px; text-align: right;">
        <button class="btn btn-danger" onclick="closeImportModal()">取消</button>
        <button class="btn" onclick="confirmImport()">导入</button>
      </div>
    </div>
  </div>

  <script>
    let map;
    let infoWindow;
    let folders = [
      { 
        id: 'default', 
        name: '默认分组', 
        markers: [], 
        color: '#0d6efd'
      }
    ];
    let nextFolderId = 1;
    let nextMarkerId = 1;
    let pendingPosition = null;
    let editingMarkerId = null;
    let expandedFolders = new Set(['default']);
    let sidebarVisible = false;
    const STORAGE_KEY = 'map_folders_v8';

    // ✅ 圆点标记存储
    const mapMarkers = {};

    window.onload = function () {
      map = new AMap.Map('map', {
        zoom: 10,
        center: [116.4096, 39.9155],
        viewMode: '2D',
        mapStyle: 'amap://styles/normal'
      });

      infoWindow = new AMap.InfoWindow({ offset: new AMap.Pixel(0, -10) });

      map.on('click', function (e) {
        openAddMarkerModal(e.lnglat);
      });

      const today = new Date().toISOString().split('T')[0];
      document.getElementById('inputStart').value = today;
      document.getElementById('inputEnd').value = today;

      // ✅ 初始化搜索功能
      initSearch();

      loadFromStorage();
      renderSidebar();
      updateStats();
    };

    // ========== 搜索功能 ==========
    function initSearch() {
      const input = document.getElementById('search-input');
      const autoOptions = {
        input
      };
      const autocomplete = new AMap.Autocomplete(autoOptions);
      const placeSearch = new AMap.PlaceSearch({
        map: map,
        panel: null
      });

      AMap.event.addListener(autocomplete, 'select', function (e) {
        placeSearch.search(e.poi.name, function (status, result) {
          if (status === 'complete' && result.poiList && result.poiList.pois.length > 0) {
            const poi = result.poiList.pois[0];
            map.setCenter(poi.location);
            map.setZoom(16);
            // 可选：自动添加标记？此处仅定位
          }
        });
      });

      input.addEventListener('keypress', function (e) {
        if (e.key === 'Enter') {
          const keyword = input.value.trim();
          if (keyword) {
            placeSearch.search(keyword, function (status, result) {
              if (status === 'complete' && result.poiList && result.poiList.pois.length > 0) {
                const poi = result.poiList.pois[0];
                map.setCenter(poi.location);
                map.setZoom(16);
              } else {
                alert('未找到相关地点');
              }
            });
          }
        }
      });
    }

    // ========== 核心：创建圆点标记 ==========
    function createMapMarker(data) {
      // ✅ 使用 CircleMarker 实现蓝色圆点
      const circleMarker = new AMap.CircleMarker({
        center: [data.lng, data.lat],
        radius: 6, // 圆点半径
        strokeColor: '#1a73e8',
        strokeOpacity: 1,
        strokeWeight: 2,
        fillColor: '#1a73e8',
        fillOpacity: 0.8,
        zIndex: 100,
        map: map
      });

      circleMarker.customData = data;

      circleMarker.on('click', () => {
        openInfoWindow(circleMarker);
      });

      mapMarkers[data.id] = circleMarker;
    }

    function createInfoContent(data) {
      const folder = folders.find(f => f.id === data.folderId);
      const folderName = folder ? folder.name : '未知分组';
      const description = data.description ? `<p><strong>描述:</strong> ${data.description}</p>` : '';
      return `
        <div class="info-content">
          <h4>${data.title}</h4>
          <p><strong>分组:</strong> ${folderName}</p>
          ${description}
          <p><strong>开始:</strong> ${data.startDate}</p>
          <p><strong>结束:</strong> ${data.endDate}</p>
          <div style="margin-top:10px;">
            <button class="btn btn-warning btn-sm" onclick="openEditMarkerModal('${data.id}')">编辑</button>
            <button class="btn btn-danger btn-sm" onclick="deleteMarker('${data.id}')">删除</button>
          </div>
        </div>
      `;
    }

    function openInfoWindow(marker) {
      infoWindow.close();
      const content = createInfoContent(marker.customData);
      infoWindow.setContent(content);
      infoWindow.open(map, marker.getCenter());
    }

    // ========== 其他函数保持不变（略） ==========

    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const navItem = document.getElementById('navMarkers');
      if (sidebarVisible) {
        sidebar.classList.add('hidden');
        navItem.classList.remove('active');
        sidebarVisible = false;
      } else {
        sidebar.classList.remove('hidden');
        navItem.classList.add('active');
        sidebarVisible = true;
      }
    }

    function openAddMarkerModal(lnglat) {
      if (!sidebarVisible) toggleSidebar();
      pendingPosition = lnglat;
      editingMarkerId = null;
      document.getElementById('modalTitle').textContent = '添加标记';
      document.getElementById('confirmBtn').textContent = '添加';
      document.getElementById('inputTitle').value = '';
      document.getElementById('inputDescription').value = '';
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('inputStart').value = today;
      document.getElementById('inputEnd').value = today;
      updateFolderSelect();
      document.getElementById('addMarkerModal').style.display = 'flex';
    }

    function closeAddMarkerModal() {
      document.getElementById('addMarkerModal').style.display = 'none';
      pendingPosition = null;
      editingMarkerId = null;
    }

    function updateFolderSelect(selectedFolderId = null) {
      const sel = document.getElementById('folderSelect');
      sel.innerHTML = '';
      folders.forEach(folder => {
        const opt = document.createElement('option');
        opt.value = folder.id;
        opt.textContent = folder.name;
        if (selectedFolderId && folder.id === selectedFolderId) opt.selected = true;
        sel.appendChild(opt);
      });
    }

    function confirmAddMarker() {
      const title = document.getElementById('inputTitle').value.trim();
      const description = document.getElementById('inputDescription').value.trim();
      const start = document.getElementById('inputStart').value;
      const end = document.getElementById('inputEnd').value;
      const folderId = document.getElementById('folderSelect').value;

      if (!title || !start || !end) {
        alert('请填写必填项');
        return;
      }

      const startDate = new Date(start);
      const endDate = new Date(end);
      if (startDate > endDate) {
        alert('开始日期不能晚于结束日期');
        return;
      }

      if (editingMarkerId) {
        const marker = mapMarkers[editingMarkerId];
        if (marker) {
          marker.customData.title = title;
          marker.customData.description = description;
          marker.customData.startDate = start;
          marker.customData.endDate = end;
          if (marker.customData.folderId !== folderId) {
            const oldFolder = folders.find(f => f.id === marker.customData.folderId);
            if (oldFolder) {
              const idx = oldFolder.markers.indexOf(editingMarkerId);
              if (idx !== -1) oldFolder.markers.splice(idx, 1);
            }
            const newFolder = folders.find(f => f.id === folderId);
            if (newFolder) newFolder.markers.push(editingMarkerId);
          }
          marker.customData.folderId = folderId;
          if (infoWindow.getIsOpen()) {
            const content = createInfoContent(marker.customData);
            infoWindow.setContent(content);
          }
        }
      } else {
        const lng = pendingPosition.getLng();
        const lat = pendingPosition.getLat();
        const markerId = 'm_' + nextMarkerId++;
        const markerData = {
          id: markerId,
          title,
          description,
          startDate: start,
          endDate: end,
          lng: lng,
          lat: lat,
          folderId: folderId
        };

        createMapMarker(markerData);

        const folder = folders.find(f => f.id === folderId);
        if (folder) folder.markers.push(markerId);
      }

      saveToStorage();
      renderSidebar();
      updateStats();
      closeAddMarkerModal();
    }

    window.deleteMarker = function (markerId) {
      infoWindow.close();
      const marker = mapMarkers[markerId];
      if (marker) {
        marker.setMap(null);
        delete mapMarkers[markerId];
      }
      for (let folder of folders) {
        const idx = folder.markers.indexOf(markerId);
        if (idx !== -1) folder.markers.splice(idx, 1);
      }
      saveToStorage();
      renderSidebar();
      updateStats();
    };

    function createNewFolder() {
      const name = prompt('请输入分组名称:');
      if (name && name.trim()) {
        const colors = ['#0d6efd', '#198754', '#ffc107', '#dc3545', '#6f42c1', '#fd7e14'];
        const color = colors[Math.floor(Math.random() * colors.length)];
        folders.push({
          id: 'f_' + nextFolderId++,
          name: name.trim(),
          markers: [],
          color: color
        });
        saveToStorage();
        renderSidebar();
        updateStats();
      }
    }

    function deleteFolder(folderId) {
      if (folderId === 'default') {
        alert('不能删除默认分组');
        return;
      }
      if (!confirm('确定要删除此分组吗？该分组下的所有标记也将被删除。')) return;
      const folderIdx = folders.findIndex(f => f.id === folderId);
      if (folderIdx !== -1) {
        const folder = folders[folderIdx];
        folder.markers.forEach(markerId => {
          const marker = mapMarkers[markerId];
          if (marker) {
            marker.setMap(null);
            delete mapMarkers[markerId];
          }
        });
        folders.splice(folderIdx, 1);
      }
      saveToStorage();
      renderSidebar();
      updateStats();
    }

    function toggleFolder(folderId) {
      if (expandedFolders.has(folderId)) {
        expandedFolders.delete(folderId);
      } else {
        expandedFolders.add(folderId);
      }
      renderSidebar();
    }

    function renderSidebar() {
      const container = document.getElementById('folder-list');
      container.innerHTML = '';
      folders.forEach(folder => {
        const folderEl = document.createElement('div');
        folderEl.className = 'folder-item';
        const isExpanded = expandedFolders.has(folder.id);
        const toggleIcon = isExpanded ? '▼' : '▶';
        const headerEl = document.createElement('div');
        headerEl.className = 'folder-header';
        headerEl.innerHTML = `
          <div class="folder-title" onclick="toggleFolder('${folder.id}')">
            <span>${toggleIcon} ${folder.name}</span>
            <span class="marker-count">(${folder.markers.length})</span>
          </div>
          <div class="folder-actions">
            <button class="btn btn-sm btn-warning" onclick="openEditFolderModal('${folder.id}');event.stopPropagation();">编辑</button>
            <button class="btn btn-sm btn-danger" onclick="deleteFolder('${folder.id}');event.stopPropagation();">删除</button>
          </div>
        `;
        folderEl.appendChild(headerEl);
        const markersEl = document.createElement('div');
        markersEl.className = `marker-list ${isExpanded ? 'show' : ''}`;
        folder.markers.forEach(mid => {
          const m = getMarkerDataById(mid);
          if (!m) return;
          const item = document.createElement('div');
          item.className = 'marker-item';
          item.innerHTML = `
            <div class="marker-title">
              <div>${m.title}</div>
              <div class="marker-date">${m.startDate} ~ ${m.endDate}</div>
            </div>
            <div class="marker-actions">
              <button class="btn btn-sm btn-warning" onclick="openEditMarkerModal('${mid}');event.stopPropagation();">编辑</button>
              <button class="btn btn-sm btn-danger" onclick="deleteMarker('${mid}');event.stopPropagation();">删除</button>
            </div>
          `;
          item.onclick = (e) => {
            if (e.target.tagName !== 'BUTTON') {
              const mapMarker = mapMarkers[mid];
              if (mapMarker) {
                map.setCenter(mapMarker.getCenter());
                map.setZoom(14);
                openInfoWindow(mapMarker);
              }
            }
          };
          markersEl.appendChild(item);
        });
        folderEl.appendChild(markersEl);
        container.appendChild(folderEl);
      });
    }

    function getMarkerDataById(id) {
      for (let folder of folders) {
        for (let mid of folder.markers) {
          if (mid === id) {
            return mapMarkers[id]?.customData || null;
          }
        }
      }
      return null;
    }

    function updateStats() {
      let totalMarkers = 0;
      let totalFolders = 0;
      folders.forEach(folder => {
        totalMarkers += folder.markers.length;
        totalFolders += 1;
      });
      document.getElementById('total-markers').textContent = totalMarkers;
      document.getElementById('total-folders').textContent = totalFolders;
    }

    function saveToStorage() {
      const data = { folders, nextFolderId, nextMarkerId };
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      const markerData = {};
      Object.keys(mapMarkers).forEach(id => {
        const m = mapMarkers[id];
        markerData[id] = m.customData;
      });
      localStorage.setItem(STORAGE_KEY + '_markers', JSON.stringify(markerData));
    }

    function loadFromStorage() {
      const data = localStorage.getItem(STORAGE_KEY);
      const markerDataStr = localStorage.getItem(STORAGE_KEY + '_markers');
      if (data) {
        const parsed = JSON.parse(data);
        folders = parsed.folders || folders;
        nextFolderId = parsed.nextFolderId || 1;
        nextMarkerId = parsed.nextMarkerId || 1;
      }
      if (markerDataStr) {
        const markerData = JSON.parse(markerDataStr);
        Object.values(markerData).forEach(d => {
          createMapMarker(d);
          const folder = folders.find(f => f.id === d.folderId);
          if (folder) folder.markers.push(d.id);
        });
      }
      updateStats();
    }

    function openEditFolderModal(folderId) {
      const folder = folders.find(f => f.id === folderId);
      if (!folder) return;
      document.getElementById('editFolderName').value = folder.name;
      window.currentEditingFolderId = folderId;
      document.getElementById('editFolderModal').style.display = 'flex';
    }

    function closeEditFolderModal() {
      document.getElementById('editFolderModal').style.display = 'none';
      window.currentEditingFolderId = null;
    }

    function confirmEditFolder() {
      const newName = document.getElementById('editFolderName').value.trim();
      if (!newName) {
        alert('请输入分组名称');
        return;
      }
      const folder = folders.find(f => f.id === window.currentEditingFolderId);
      if (folder) folder.name = newName;
      saveToStorage();
      renderSidebar();
      closeEditFolderModal();
    }

    function showImportModal() {
      if (!sidebarVisible) toggleSidebar();
      document.getElementById('importModal').style.display = 'flex';
    }

    function closeImportModal() {
      document.getElementById('importModal').style.display = 'none';
      document.getElementById('importData').value = '';
    }

    function confirmImport() {
      const dataStr = document.getElementById('importData').value.trim();
      if (!dataStr) {
        alert('请输入数据');
        return;
      }
      try {
        const importedData = JSON.parse(dataStr);
        if (Array.isArray(importedData.markers)) {
          importedData.markers.forEach(markerData => {
            const markerId = 'm_' + nextMarkerId++;
            let targetFolder = folders.find(f => f.id === markerData.folderId);
            if (!targetFolder) targetFolder = folders[0];
            const fullMarkerData = { ...markerData, id: markerId, folderId: targetFolder.id };
            createMapMarker(fullMarkerData);
            targetFolder.markers.push(markerId);
          });
          alert(`成功导入 ${importedData.markers.length} 个标记`);
        } else {
          alert('数据格式不正确，请确保数据包含markers数组');
          return;
        }
        saveToStorage();
        renderSidebar();
        updateStats();
        closeImportModal();
      } catch (e) {
        alert('JSON格式错误: ' + e.message);
      }
    }

    function openEditMarkerModal(markerId) {
      const marker = mapMarkers[markerId];
      if (!marker) return;
      const data = marker.customData;
      editingMarkerId = markerId;
      document.getElementById('modalTitle').textContent = '编辑标记';
      document.getElementById('confirmBtn').textContent = '更新';
      document.getElementById('inputTitle').value = data.title;
      document.getElementById('inputDescription').value = data.description || '';
      document.getElementById('inputStart').value = data.startDate;
      document.getElementById('inputEnd').value = data.endDate;
      updateFolderSelect(data.folderId);
      document.getElementById('addMarkerModal').style.display = 'flex';
    }
  </script>
</body>
</html>